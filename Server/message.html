<html>
<head>
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta charset="utf-8">
  <title>アプリファクトリー</title>
  <link rel="shortcut icon" href="img/icon.png" type="image/png">
  <style>
    body {
      background: #fff;
    }
    body, div, span, td {
      margin: 0;
      padding: 0;
      font-family: "ヒラギノ角ゴ Pro", "Hiragino Kaku Gothic Pro",Lucida Grande,"メイリオ", Meiryo, Tahoma, Verdana, Osaka, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
      font-size: 14px;
      color: #333;
    }
    a {
      text-decoration: none;
      color: #333;
    }

    input[type="text"] {
      border: 1px solid #ddd;
      border-radius:6px;
      -webkit-border-radius:6px;
      -moz-border-radius:6px;
      padding: 0 10px;
    }

    input[type="text"]:focus {
      outline: 0;
      border-color: orange;
    }

    textarea {
      border: 1px solid #ddd;
      border-radius:6px;
      -webkit-border-radius:6px;
      -moz-border-radius:6px;
      padding: 10px;
    }

    textarea:focus {
      outline: 0;
      border-color: orange;
    }

  </style>

  <script src="common.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script type="text/javascript">

  var gAgreeTerms = false;

  function onClickSend() {

    var errorMessage = "";

    if (gAgreeTerms == false) {
      errorMessage = "利用規約の同意が必要です";
    }

    var email = base64Encode(document.getElementById("email").value);
//    var email = btoa(unescape(encodeURIComponent(document.getElementById("email").value)));
    if (email.length == 0) {
      errorMessage = "ご連絡先が未入力です";
    }

//    var message = btoa(unescape(encodeURIComponent(document.getElementById("message").value)));
    var message = base64Encode(document.getElementById("message").value);
    if (message.length == 0) {
      errorMessage = "メッセージが未入力です";
    }

    if (errorMessage.length > 0) {
      swal({
        text: errorMessage,
        icon: "warning",
        dangerMode: true
      });
      return;
    }

    var url = "srv.php?command=sendmessage&sender=" + email + "&target=" + getParameter("id") + "&message=" + message;
    httpPost(url, null, function(data) {
      var parsed = null;
      try {
        parsed = JSON.parse(data);
        if (!parsed) {
          return;
        }
      } catch(e) {
        return;
      }
      if (parsed.result == null) {
        return;
      }
      if (parsed.result == 0) {
        swal("送信完了", "ご連絡ありがとうございました。返信をお待ちください。", "success")
        .then((willDelete) => {
          setTimeout(function() {
            location.href = "engineerdetail.html?id=" + getParameter("id");
          }, 100);
        });
      }
    });
  }

  function getParameter(key) {
    var url = window.location.href;
      urlSplit = url.split("?");
      if (urlSplit.length >= 2) {
          var paramSplit = urlSplit[1].split("&");
          for (var i=0;i<paramSplit.length;i++) {
              var keyVal = paramSplit[i].split("=");
              if (keyVal.length == 2) {
                  if (keyVal[0] == key) {
                      return keyVal[1];
                  }
              }
          }
      }
      return "";
  }

  function onCheckTerms() {

    if (gAgreeTerms) {
      gAgreeTerms = false;
      document.getElementById("termsAgree").src = "img/check_off.png";
    } else {
      gAgreeTerms = true;
      document.getElementById("termsAgree").src = "img/check_on.png";
    }
  }

  </script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110054488-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110054488-2');
  </script>

</head>
<body>

  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.10";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- ヘッダ -->
  <div style="top:0px;width:100%;height:50px;position:fixed;z-index:1;background:#fff">
    <table border="0" cellspacing="0" style="width:100%;height:100%">
      <tr>
        <td style="width:50px"></td>
        <td style="text-align:center;vertical-align:middle;width:50px;height:100%;background:#262626">
          <span style="color:#fff;font-size:18px">E</span>
        </td>
        <td style="width:170px;text-align:center">
          <a href="index.html" style="font-size:12px;font-weight:bold;">アプリファクトリー</a>
        </td>
        <td style="width:1px;padding:13px 0">
          <div style="width:100%;height:100%;background:#262626;"></div>
        </td>
        <td style="width:120px;text-align:center">
          <a href="engineer.html" style="font-size:12px;font-weight:bold;">Engineers.</a>
        </td>
        <td style="width:90px;text-align:center">
          <a href="gallery.html" style="font-size:12px;font-weight:bold;">Gallery.</a>
        </td>
        <td style="width:100px;text-align:center">
          <a href="diagramlist.html" style="font-size:12px;font-weight:bold;">Diagram.</a>
        </td>
        <td style="background:#fff;text-align:right">
          <table border="0" cellspacing="0" style="margin:0 0 0 auto">
            <tr>
              <td>
                <td style="">
                  <div class="fb-like" data-href="http://datastore.work/engineernave/" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
                </td>
                <td style="width:14px"></td>
                <td style="">
                  <a href="https://twitter.com/share" class="twitter-share-button"></a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </td>
                <td style="width:40px"></td>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>

  <!-- コンテンツ -->
  <div style="margin:0 auto;width:600px">
    <table border="0" cellspacing="0" style="margin-top:120px">
      <tr>
        <td>
          <img src="img/lock.png" style="width:16px">
        </td>
        <td style="width:6px"></td>
        <td style="font-size:12px;font-weight:bold">
          メッセージ
        </td>
      </tr>
    </table>

    <div style="margin-top:10px;background:#f2f2f2">
      <div style="height:50px"></div>
      <table border="0" cellspacing="0" style="width:100%;">
        <tr>
          <td style="width:60px"></td>
          <td style="width:20%;text-align:left;">
            宛先
          </td>
          <td>
            <table border="0" cellspacing="0" style="width:100%">
              <tr>
                <td>
                  <img id="engineer_image" style="width:30px;height:auto" onerror="this.src='img/no_img.png';">
                </td>
                <td style="width:8px"></td>
                <td id="engineer_name" style="font-size:12px;width:100%">
                </td>
              </tr>
            </table>
          </td>
          <td style="width:60px"></td>
        </tr>
        <tr><td style="height:20px"></td></tr>
        <tr>
          <td></td>
          <td style="text-align:left;vertical-align:top">
            <div style="line-height:36px">メッセージ</div>
          </td>
          <td>
            <textarea id="message" style="width:100%;height:180px;resize:none" placeholder="過去の実績、費用の目安など"></textarea>
          </td>
          <td></td>
        </tr>
        <tr><td style="height:20px"></td></tr>
        <tr>
          <td></td>
          <td style="text-align:left;vertical-align:top">
            <div style="line-height:36px">ご連絡先</div>
          </td>
          <td>
            <input id="email" type="text" style="width:100%;height:34px" placeholder="メールアドレス、電話番号など">
          </td>
          <td></td>
        </tr>
      </table>
      <div style="height:50px"></div>
    </div>

    <div style="height:40px"></div>

    <table border="0" cellspacing="0" style="margin:0 auto">
      <tr>
        <td>
          <a href="javascript:onCheckTerms()">
            <img id="termsAgree" src="img/check_off.png" style="width:18px">
          </a>
        </td>
        <td style="width:6px"></td>
        <td>
          <a href="terms.html" style="color:#1fcba9;font-weight:bold;font-size:12px">
            利用規約
          </a>
          <span style="font-size:12px">に同意する</span>
        </td>
      </tr>
    </table>

    <div style="height:12px"></div>

    <a href="javascript:onClickSend()">
      <div style="width:170px;height:40px;margin:0 auto;border-radius:20px;-webkit-border-radius:20px;-moz-border-radius:20px;font-size:12px;font-weight:bold;background:#ffc32e;line-height:40px;text-align:center">
        送信する
      </div>
    </a>
  </div>

  <!-- フッター -->
  <div style="margin:100px auto 0 auto;width:90%;background-image:radial-gradient(#e0e0e0 20%, transparent 20%);background-size:10px 10px;">
    <div style="height:30px"></div>
    <table border="0" cellspacing="0" style="margin:0 auto;width:95%">
      <tr>
        <td style="width:33%;text-align:center;vertical-align:top">
          <div style="font-size:14px;font-weight:bold">
            依頼する
          </div>
          <div style="margin-top:10px">
            <a href="engineer.html" style="font-size:12px;color:#7f7f7f">
              開発者を探す
            </a>
          </div>
          <div style="margin-top:4px">
            <a href="gallery.html" style="font-size:12px;color:#7f7f7f">
              デザインから選ぶ
            </a>
          </div>
        </td>
        <td style="width:33%;text-align:center;;vertical-align:top">
          <div style="font-size:14px;font-weight:bold">
            仕事を受ける
          </div>
          <div style="margin-top:10px">
            <a href="join.html" style="font-size:12px;color:#7f7f7f">
              開発者として登録する
            </a>
          </div>
        </td>
        <td style="width:33%;font-size:14px;font-weight:bold;text-align:center;vertical-align:top">
          <div style="font-size:14px;font-weight:bold">
            運営会社
          </div>
          <div style="margin-top:10px">
            <a href="http://lfg.co.jp/" style="font-size:12px;color:#7f7f7f;font-weight:normal">
              会社ホームページ
            </a>
          </div>
          <div style="margin-top:4px">
            <a href="http://lfg.co.jp/company.html" style="font-size:12px;color:#7f7f7f;font-weight:normal">
              会社概要
            </a>
          </div>
          <div style="margin-top:4px">
            <a href="terms.html" style="font-size:12px;color:#7f7f7f;font-weight:normal">
              利用規約
            </a>
          </div>
        </td>
      </tr>
    </table>
    <div style="height:26px"></div>
  </div>

  <div style="margin:20px auto 30px auto;text-align:center;width:100%;font-size:12px">
    copyright&copy; Leapfrog Inc. all rights reserved.
  </div>

  <script type="text/javascript">
    var url = "srv.php?command=getengineerdetail&id=" + getParameter("id");
    httpPost(url, null, function(data) {
      var parsed = null;
      try {
        parsed = JSON.parse(data);
        if (!parsed) {
          return;
        }
      } catch(e) {
        return;
      }
      if ((parsed.id == null) || (parsed.name == null)) {
        return;
      }
      document.getElementById("engineer_image").src = "data/img/user/" + parsed.id + ".png";
      document.getElementById("engineer_name").innerHTML = parsed.name;
    });

  </script>

</body>
</html>
